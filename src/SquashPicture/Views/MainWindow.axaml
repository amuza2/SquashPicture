<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:SquashPicture.ViewModels"
        xmlns:converters="using:SquashPicture.Converters"
        mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="400"
        x:Class="SquashPicture.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="{Binding WindowTitle}"
        Width="600" Height="400"
        MinWidth="500" MinHeight="300">

    <Window.Resources>
        <converters:FileSizeConverter x:Key="FileSizeConverter"/>
        <converters:CompressionRatioConverter x:Key="CompressionRatioConverter"/>
        <converters:StatusToColorConverter x:Key="StatusToColorConverter"/>
    </Window.Resources>

    <Window.KeyBindings>
        <KeyBinding Gesture="Alt+A" Command="{Binding AddFilesCommand}"/>
        <KeyBinding Gesture="Alt+R" Command="{Binding RecompressCommand}"/>
    </Window.KeyBindings>

    <DockPanel>
        <!-- Toolbar -->
        <Border DockPanel.Dock="Top" 
                Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
                Padding="10">
            <StackPanel Spacing="8">
                <!-- Top row: Buttons -->
                <Grid ColumnDefinitions="Auto,*,Auto">
                    <!-- Add Files Button -->
                    <Button Grid.Column="0"
                            Command="{Binding AddFilesCommand}"
                            Padding="15,8">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="+" FontSize="16" FontWeight="Bold"/>
                            <TextBlock Text="Add and compress" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <!-- Checkbox in center -->
                    <CheckBox Grid.Column="1"
                              Content="Replace original files"
                              IsChecked="{Binding ReplaceOriginalFiles}"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center"/>

                    <!-- Recompress Button -->
                    <Button Grid.Column="2"
                            Command="{Binding RecompressCommand}"
                            Padding="15,8">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="â†»" FontSize="16"/>
                            <TextBlock Text="Recompress" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </Grid>
            </StackPanel>
        </Border>

        <!-- DataGrid with placeholder -->
        <Grid Margin="10">
            <!-- Placeholder text - shown when no files -->
            <TextBlock Text="Drag and drop images here or click 'Add and compress'"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       Opacity="0.5"
                       FontSize="14"
                       IsVisible="{Binding !HasFiles}"/>
            
            <!-- DataGrid -->
            <DataGrid ItemsSource="{Binding Images}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      CanUserReorderColumns="False"
                      CanUserResizeColumns="True"
                      GridLinesVisibility="Horizontal"
                      BorderThickness="0">
                <DataGrid.Columns>
                <!-- Filename Column -->
                <DataGridTextColumn Header="Filename" 
                                    Width="*"
                                    Binding="{Binding FileName}"/>

                <!-- Original Size Column -->
                <DataGridTextColumn Header="Old Size" 
                                    Width="100"
                                    Binding="{Binding OriginalSize, Converter={StaticResource FileSizeConverter}}"/>

                <!-- Compressed Size Column -->
                <DataGridTextColumn Header="New Size" 
                                    Width="100"
                                    Binding="{Binding CompressedSize, Converter={StaticResource FileSizeConverter}}"/>

                <!-- Compression Ratio Column -->
                <DataGridTemplateColumn Header="Compressed" Width="120">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate x:DataType="vm:ImageItemViewModel">
                            <TextBlock VerticalAlignment="Center"
                                       HorizontalAlignment="Center"
                                       Foreground="{Binding Status, Converter={StaticResource StatusToColorConverter}}">
                                <TextBlock.Text>
                                    <MultiBinding Converter="{StaticResource CompressionRatioConverter}">
                                        <Binding Path="Status"/>
                                        <Binding Path="CompressionRatio"/>
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </DockPanel>
</Window>
