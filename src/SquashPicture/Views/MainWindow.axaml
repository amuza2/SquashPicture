<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:SquashPicture.ViewModels"
        xmlns:converters="using:SquashPicture.Converters"
        mc:Ignorable="d" d:DesignWidth="750" d:DesignHeight="550"
        x:Class="SquashPicture.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/icons8-image-100.png"
        Title="{Binding WindowTitle}"
        Width="750" Height="550"
        MinWidth="650" MinHeight="450"
        Background="{DynamicResource NeuroBackgroundBrush}">

    <Window.Resources>
        <converters:FileSizeConverter x:Key="FileSizeConverter"/>
        <converters:CompressionRatioConverter x:Key="CompressionRatioConverter"/>
        <converters:StatusToColorConverter x:Key="StatusToColorConverter"/>
    </Window.Resources>

    <Window.KeyBindings>
        <KeyBinding Gesture="Alt+A" Command="{Binding AddFilesCommand}"/>
        <KeyBinding Gesture="Alt+R" Command="{Binding RecompressCommand}"/>
        <KeyBinding Gesture="Alt+C" Command="{Binding ClearCommand}"/>
        <KeyBinding Gesture="Ctrl+Q"/>
    </Window.KeyBindings>

    <Grid RowDefinitions="Auto,*">
        
        <!-- Neumorphism Toolbar -->
        <Border Grid.Row="0" 
                Classes="toolbar">
            <Grid ColumnDefinitions="Auto,*,Auto">
                
                <!-- Left: Primary Actions -->
                <StackPanel Grid.Column="0" 
                            Orientation="Horizontal" 
                            Spacing="16">
                    <Button Theme="{StaticResource PrimaryButton}"
                            Command="{Binding AddFilesCommand}">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <TextBlock Text="+" FontSize="18" FontWeight="Bold" Margin="0,-2,0,0"/>
                            <TextBlock Text="Add Images" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Theme="{StaticResource SecondaryButton}"
                            Command="{Binding RecompressCommand}">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <TextBlock Text="â†»" FontSize="16"/>
                            <TextBlock Text="Recompress" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
                
                <!-- Center: Options -->
                <StackPanel Grid.Column="1" 
                            Orientation="Horizontal" 
                            HorizontalAlignment="Center"
                            Spacing="16">
                    <CheckBox Theme="{StaticResource ModernCheckBox}"
                              Content="Replace original files"
                              IsChecked="{Binding ReplaceOriginalFiles}"/>
                </StackPanel>
                
                <!-- Right: Secondary Actions -->
                <StackPanel Grid.Column="2" 
                            Orientation="Horizontal" 
                            Spacing="12">
                    <Button Theme="{StaticResource SecondaryButton}"
                            Command="{Binding ClearCommand}"
                            Padding="16,12">
                        <TextBlock Text="Clear"/>
                    </Button>
                    
                    <!-- Info Button -->
                    <Button Theme="{StaticResource IconButton}"
                            ToolTip.Tip="About SquashPicture">
                        <Button.Flyout>
                            <Flyout Placement="BottomEdgeAlignedRight"
                                    FlyoutPresenterTheme="{StaticResource ModernFlyoutPresenter}">
                                <StackPanel Spacing="16" MinWidth="240">
                                    <!-- App Header -->
                                    <StackPanel Spacing="6">
                                        <TextBlock Text="SquashPicture" Classes="h2"/>
                                        <TextBlock Text="Version 1.0.0" Classes="caption"/>
                                    </StackPanel>
                                    
                                    <Separator/>
                                    
                                    <!-- Keyboard Shortcuts -->
                                    <StackPanel Spacing="10">
                                        <TextBlock Text="KEYBOARD SHORTCUTS" Classes="label"/>
                                        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto,Auto" Margin="0,4,0,0">
                                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Alt+A" Classes="mono"/>
                                            <TextBlock Grid.Row="0" Grid.Column="1" Text="Add files" Classes="body-secondary" Margin="16,0,0,0"/>
                                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Alt+R" Classes="mono"/>
                                            <TextBlock Grid.Row="1" Grid.Column="1" Text="Recompress" Classes="body-secondary" Margin="16,0,0,0"/>
                                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Alt+C" Classes="mono"/>
                                            <TextBlock Grid.Row="2" Grid.Column="1" Text="Clear" Classes="body-secondary" Margin="16,0,0,0"/>
                                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Ctrl+Q" Classes="mono"/>
                                            <TextBlock Grid.Row="3" Grid.Column="1" Text="Quit" Classes="body-secondary" Margin="16,0,0,0"/>
                                        </Grid>
                                    </StackPanel>
                                    
                                    <Separator/>
                                    
                                    <!-- Output Path -->
                                    <StackPanel Spacing="6">
                                        <TextBlock Text="OUTPUT PATH" Classes="label"/>
                                        <TextBlock Text="{Binding OutputFolderPath}" 
                                                   TextWrapping="Wrap" 
                                                   Classes="caption"
                                                   MaxWidth="220"/>
                                    </StackPanel>
                                    
                                    <Separator/>
                                    
                                    <!-- GitHub Link -->
                                    <Button Theme="{StaticResource LinkButton}"
                                            Content="View on GitHub"
                                            Tag="https://github.com/amuza2/SquashPicture"
                                            Click="OnGitHubLinkClick"
                                            HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Flyout>
                        </Button.Flyout>
                        <TextBlock Text="ðŸ›ˆï¸Ž" FontSize="18" Foreground="{DynamicResource TextSecondaryBrush}"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Neumorphism Main Content Area -->
        <Border Grid.Row="1" 
                Margin="20"
                Background="{DynamicResource NeuroSurfaceBrush}"
                CornerRadius="20"
                BorderThickness="0"
                BoxShadow="inset 4 4 10 0 #1a1a24, inset -4 -4 10 0 #40404f">
            <Grid Margin="8">
                <!-- Placeholder - shown when no files -->
                <StackPanel HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Spacing="20"
                            IsVisible="{Binding !HasFiles}">
                    <Border Background="{DynamicResource NeuroSurfaceBrush}"
                            CornerRadius="30"
                            Padding="24"
                            BoxShadow="6 6 12 0 #1a1a24, -6 -6 12 0 #40404f"
                            HorizontalAlignment="Center">
                        <TextBlock Text="ðŸ–¼ï¸" 
                                   FontSize="48" 
                                   HorizontalAlignment="Center"
                                   Opacity="0.7"/>
                    </Border>
                    <TextBlock Text="No images added yet" 
                               Classes="placeholder"
                               FontSize="18"/>
                    <TextBlock Text="Click 'Add Images' or press Alt+A to get started" 
                               Classes="caption"
                               HorizontalAlignment="Center"/>
                </StackPanel>
                
                <!-- DataGrid -->
                <DataGrid ItemsSource="{Binding Images}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          CanUserReorderColumns="False"
                          CanUserResizeColumns="True"
                          GridLinesVisibility="None"
                          BorderThickness="0"
                          HeadersVisibility="Column"
                          Background="Transparent"
                          Foreground="{DynamicResource TextPrimaryBrush}"
                          RowBackground="Transparent"
                          IsVisible="{Binding HasFiles}"
                          Margin="8">
                    <DataGrid.Columns>
                        <!-- Status Icon Column -->
                        <DataGridTemplateColumn Header="" Width="50">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="vm:ImageItemViewModel">
                                    <TextBlock Text="{Binding StatusIcon}"
                                               Classes="status-icon"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Filename Column -->
                        <DataGridTextColumn Header="Filename" 
                                            Width="*"
                                            Binding="{Binding FileName}"/>

                        <!-- Original Size Column -->
                        <DataGridTextColumn Header="Original" 
                                            Width="100"
                                            Binding="{Binding OriginalSize, Converter={StaticResource FileSizeConverter}}"/>

                        <!-- Compressed Size Column -->
                        <DataGridTextColumn Header="Compressed" 
                                            Width="100"
                                            Binding="{Binding CompressedSize, Converter={StaticResource FileSizeConverter}}"/>

                        <!-- Savings Column -->
                        <DataGridTemplateColumn Header="Savings" Width="100">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="vm:ImageItemViewModel">
                                    <TextBlock VerticalAlignment="Center"
                                               HorizontalAlignment="Center"
                                               FontWeight="SemiBold"
                                               Foreground="{Binding Status, Converter={StaticResource StatusToColorConverter}}">
                                        <TextBlock.Text>
                                            <MultiBinding Converter="{StaticResource CompressionRatioConverter}">
                                                <Binding Path="Status"/>
                                                <Binding Path="CompressionRatio"/>
                                            </MultiBinding>
                                        </TextBlock.Text>
                                    </TextBlock>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>
    </Grid>
</Window>
