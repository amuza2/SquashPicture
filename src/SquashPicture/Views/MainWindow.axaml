<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:SquashPicture.ViewModels"
        xmlns:converters="using:SquashPicture.Converters"
        mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="400"
        x:Class="SquashPicture.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="{Binding WindowTitle}"
        Width="600" Height="400"
        MinWidth="500" MinHeight="300"
        >

    <Window.Resources>
        <converters:FileSizeConverter x:Key="FileSizeConverter"/>
        <converters:CompressionRatioConverter x:Key="CompressionRatioConverter"/>
        <converters:StatusToColorConverter x:Key="StatusToColorConverter"/>
    </Window.Resources>

    <Window.KeyBindings>
        <KeyBinding Gesture="Alt+A" Command="{Binding AddFilesCommand}"/>
        <KeyBinding Gesture="Alt+R" Command="{Binding RecompressCommand}"/>
        <KeyBinding Gesture="Alt+C" Command="{Binding ClearCommand}"/>
    </Window.KeyBindings>

    <DockPanel>
        <!-- Toolbar -->
        <Border DockPanel.Dock="Top" 
                Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
                Padding="10">
            <StackPanel Spacing="8">
                <!-- Top row: Buttons -->
                <Grid ColumnDefinitions="Auto,*,Auto,Auto">
                    <!-- Add Files Button -->
                    <Button Grid.Column="0"
                            Command="{Binding AddFilesCommand}"
                            Padding="15,8">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="+" FontSize="16" FontWeight="Bold"/>
                            <TextBlock Text="Add" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <!-- Checkbox and Clear button in center -->
                    <StackPanel Grid.Column="1" 
                                Orientation="Horizontal" 
                                HorizontalAlignment="Center"
                                Spacing="16">
                        <CheckBox Content="Replace original files"
                                  IsChecked="{Binding ReplaceOriginalFiles}"
                                  VerticalAlignment="Center"/>
                        <Button Command="{Binding ClearCommand}"
                                Padding="10,6"
                                VerticalAlignment="Center">
                            <TextBlock Text="Clear"/>
                        </Button>
                    </StackPanel>

                    <!-- Recompress Button -->
                    <Button Grid.Column="2"
                            Command="{Binding RecompressCommand}"
                            Padding="15,8">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="â†»" FontSize="16"/>
                            <TextBlock Text="Recompress" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <!-- Info Button -->
                    <Button Grid.Column="3"
                            Margin="8,0,0,0"
                            Padding="8"
                            Height="40"
                            ToolTip.Tip="About SquashPicture">
                        <Button.Flyout>
                            <Flyout Placement="BottomEdgeAlignedRight">
                                <StackPanel Spacing="8" MinWidth="150">
                                    <TextBlock Text="SquashPicture" FontWeight="Bold" FontSize="16"/>
                                    <TextBlock Text="Version 1.0.0" Opacity="0.7"/>
                                    <Separator/>
                                    <TextBlock Text="Keyboard Shortcuts" FontWeight="SemiBold"/>
                                    <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto" Margin="0,4,0,0">
                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Alt+A" FontFamily="Consolas" Opacity="0.8"/>
                                        <TextBlock Grid.Row="0" Grid.Column="1" Text="Add files" Margin="12,0,0,0"/>
                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Alt+R" FontFamily="Consolas" Opacity="0.8"/>
                                        <TextBlock Grid.Row="1" Grid.Column="1" Text="Recompress" Margin="12,0,0,0"/>
                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Alt+C" FontFamily="Consolas" Opacity="0.8"/>
                                        <TextBlock Grid.Row="2" Grid.Column="1" Text="Clear" Margin="12,0,0,0"/>
                                    </Grid>
                                    <Separator/>
                                    <TextBlock Text="Output Path" FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding OutputFolderPath}" 
                                               TextWrapping="Wrap" 
                                               Opacity="0.8"
                                               FontSize="11"/>
                                    <Separator/>
                                    <Button Classes="hyperlink" 
                                            Content="github"
                                            Tag="https://github.com/amuza2/SquashPicture"
                                            Click="OnGitHubLinkClick"
                                            Padding="0"
                                            HorizontalAlignment="Center"
                                            Background="Transparent"/>
                                </StackPanel>
                            </Flyout>
                        </Button.Flyout>
                        <TextBlock Text="ðŸ›ˆï¸Ž" FontSize="16"/>
                    </Button>
                </Grid>
            </StackPanel>
        </Border>

        <!-- DataGrid with placeholder -->
        <Border Margin="10" 
                Background="Transparent">
            <Grid>
                <!-- Placeholder text - shown when no files -->
                <TextBlock Text="Click 'Add' to select images"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Opacity="0.5"
                           FontSize="14"
                           IsVisible="{Binding !HasFiles}"/>
                
                <!-- DataGrid -->
                <DataGrid ItemsSource="{Binding Images}"
                          AutoGenerateColumns="False"
                          IsReadOnly="True"
                          CanUserReorderColumns="False"
                          CanUserResizeColumns="True"
                          GridLinesVisibility="Horizontal"
                          BorderThickness="0">
                    <DataGrid.Columns>
                        <!-- Filename Column -->
                        <DataGridTextColumn Header="Filename" 
                                            Width="*"
                                            Binding="{Binding FileName}"/>

                        <!-- Original Size Column -->
                        <DataGridTextColumn Header="Old Size" 
                                            Width="100"
                                            Binding="{Binding OriginalSize, Converter={StaticResource FileSizeConverter}}"/>

                        <!-- Compressed Size Column -->
                        <DataGridTextColumn Header="New Size" 
                                            Width="100"
                                            Binding="{Binding CompressedSize, Converter={StaticResource FileSizeConverter}}"/>

                        <!-- Compression Ratio Column -->
                        <DataGridTemplateColumn Header="Compressed" Width="120">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="vm:ImageItemViewModel">
                                    <TextBlock VerticalAlignment="Center"
                                               HorizontalAlignment="Center"
                                               Foreground="{Binding Status, Converter={StaticResource StatusToColorConverter}}">
                                        <TextBlock.Text>
                                            <MultiBinding Converter="{StaticResource CompressionRatioConverter}">
                                                <Binding Path="Status"/>
                                                <Binding Path="CompressionRatio"/>
                                            </MultiBinding>
                                        </TextBlock.Text>
                                    </TextBlock>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>
    </DockPanel>
</Window>
